<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Entrenamiento - Jhesmina Apaza Yujra</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #10b981, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle {
            text-align: center;
            opacity: 0.8;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        .info-box {
            background: rgba(16, 185, 129, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #10b981;
        }
        .info-box h3 {
            color: #10b981;
            margin-bottom: 15px;
        }
        .info-box p {
            margin: 8px 0;
            line-height: 1.6;
        }
        button {
            width: 100%;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 0;
        }
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.4);
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        button:active:not(:disabled) {
            transform: translateY(0);
        }
        #console {
            background: #000;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 500px;
            overflow-y: auto;
            margin-top: 20px;
            white-space: pre-wrap;
            line-height: 1.8;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        .log-success { color: #10b981; font-weight: bold; }
        .log-warning { color: #fbbf24; }
        .log-error { color: #ef4444; font-weight: bold; }
        .log-info { color: #60a5fa; }
        .log-normal { color: #d1d5db; }
        
        .progress-bar {
            width: 100%;
            height: 35px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 17px;
            overflow: hidden;
            margin: 20px 0;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            width: 0%;
            transition: width 0.5s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: rgba(16, 185, 129, 0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(135deg, #10b981, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .stat-label {
            opacity: 0.8;
            margin-top: 8px;
            font-size: 0.9em;
        }
        .warning-box {
            background: rgba(251, 191, 36, 0.1);
            border-left: 4px solid #fbbf24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .warning-box strong {
            color: #fbbf24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß† Sistema de Entrenamiento</h1>
        <p class="subtitle">Red Neuronal | Jhesmina Apaza Yujra - Grupo 5</p>
        
        <div class="info-box">
            <h3>üìä Configuraci√≥n del Modelo</h3>
            <p><strong>Arquitectura:</strong> 3 entradas ‚Üí 6 neuronas ocultas ‚Üí 4 salidas</p>
            <p><strong>Entradas:</strong> [% Sustituir, % Potenciar, % Humano]</p>
            <p><strong>Salidas:</strong> 4 clases de liderazgo (L√≠der Humano, Colaborador Eficaz, Dependiente Pasivo, Aut√≥mata Controlado)</p>
            <p><strong>Dataset:</strong> 27 ejemplos balanceados</p>
            <p><strong>Iteraciones:</strong> 10,000</p>
            <p><strong>Tasa de aprendizaje:</strong> 0.3</p>
        </div>

        <div class="warning-box">
            <strong>‚ö†Ô∏è Importante:</strong> Este archivo usa el <code>neural_network.js</code> de Cespedes.
            Aseg√∫rate de tener ese archivo en la misma carpeta.
        </div>

        <div class="stats" id="stats" style="display: none;">
            <div class="stat-card">
                <div class="stat-value" id="accuracy">0%</div>
                <div class="stat-label">Precisi√≥n</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="iterations">0</div>
                <div class="stat-label">Iteraciones</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="examples">27</div>
                <div class="stat-label">Ejemplos</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="time">0s</div>
                <div class="stat-label">Tiempo</div>
            </div>
        </div>

        <div class="progress-bar" id="progress-container" style="display: none;">
            <div class="progress-fill" id="progress">0%</div>
        </div>

        <button id="train-btn" onclick="iniciarEntrenamiento()">
            üöÄ Iniciar Entrenamiento
        </button>

        <button id="test-btn" onclick="probarModelo()" style="display: none;">
            üéØ Probar Modelo con Ejemplos
        </button>

        <button id="export-btn" onclick="exportarPesos()" style="display: none;">
            üíæ Exportar Pesos Entrenados
        </button>

        <div id="console"></div>
    </div>

    <!-- IMPORTAR neural_network.js de Cespedes -->
    <script src="neural_network.js"></script>
    
    <!-- IMPORTAR train_model.js (tu c√≥digo) -->
    <script src="train_model.js"></script>
    
    <!-- IMPORTAR trained_weights.js -->
    <script src="trained_weights.js"></script>
    
    <script>
        let model = null;
        let startTime = 0;

        function log(message, type = 'normal') {
            const consoleEl = document.getElementById('console');
            const line = document.createElement('div');
            line.className = `log-${type}`;
            line.textContent = message;
            consoleEl.appendChild(line);
            consoleEl.scrollTop = consoleEl.scrollHeight;
        }

        function updateProgress(percent) {
            const progress = document.getElementById('progress');
            progress.style.width = percent + '%';
            progress.textContent = Math.round(percent) + '%';
        }

        async function iniciarEntrenamiento() {
            document.getElementById('train-btn').disabled = true;
            document.getElementById('console').innerHTML = '';
            document.getElementById('stats').style.display = 'grid';
            document.getElementById('progress-container').style.display = 'block';
            
            startTime = Date.now();
            
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
            log('     SISTEMA DE ENTRENAMIENTO - RED NEURONAL', 'success');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
            log('', 'normal');
            
            log('üë§ Autor: Jhesmina Apaza Yujra - Grupo 5', 'info');
            log('üìÖ Fecha: ' + new Date().toLocaleDateString(), 'info');
            log('', 'normal');
            
            log('üìä Cargando dataset de entrenamiento...', 'info');
            await sleep(300);
            log(`   ‚úì ${window.TrainingModule.trainingDataset.length} ejemplos cargados correctamente`, 'success');
            log('', 'normal');
            
            log('üîß Configuraci√≥n del modelo:', 'info');
            log('   ‚Ä¢ Arquitectura: 3 ‚Üí 6 ‚Üí 4', 'normal');
            log('   ‚Ä¢ Entradas: % Sustituir, % Potenciar, % Humano', 'normal');
            log('   ‚Ä¢ Capa oculta: 6 neuronas', 'normal');
            log('   ‚Ä¢ Salidas: 4 clases de liderazgo', 'normal');
            log('   ‚Ä¢ Tasa de aprendizaje: 0.3', 'normal');
            log('   ‚Ä¢ Iteraciones: 10,000', 'normal');
            log('', 'normal');
            
            await sleep(500);
            
            log('üöÄ Iniciando proceso de entrenamiento...', 'warning');
            log('   (Esto puede tomar 10-20 segundos)', 'warning');
            log('', 'normal');
            
            // Simular progreso visual durante el entrenamiento
            const progressInterval = setInterval(() => {
                const currentProgress = parseFloat(document.getElementById('progress').textContent);
                if (currentProgress < 95) {
                    updateProgress(currentProgress + 5);
                }
            }, 1000);
            
            await sleep(300);
            
            try {
                // Entrenar usando la funci√≥n de train_model.js
                const weights = window.TrainingModule.entrenarModelo(SimpleNeuralNetwork);
                
                clearInterval(progressInterval);
                updateProgress(100);
                
                // Guardar pesos en TRAINED_WEIGHTS
                window.TRAINED_WEIGHTS.weights_ih = weights.weights_ih;
                window.TRAINED_WEIGHTS.weights_ho = weights.weights_ho;
                window.TRAINED_WEIGHTS.bias_h = weights.bias_h;
                window.TRAINED_WEIGHTS.bias_o = weights.bias_o;
                
                // Crear instancia del modelo para pruebas
                model = new SimpleNeuralNetwork(3, 6, 4);
                model.setWeights(weights);
                
                const endTime = Date.now();
                const totalTime = ((endTime - startTime) / 1000).toFixed(1);
                
                log('', 'normal');
                log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
                log('   ‚úÖ ENTRENAMIENTO COMPLETADO EXITOSAMENTE', 'success');
                log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
                log('', 'normal');
                
                log('üì¶ Resultados:', 'info');
                log(`   ‚Ä¢ Tiempo total: ${totalTime} segundos`, 'normal');
                log('   ‚Ä¢ Pesos guardados en memoria', 'success');
                log('   ‚Ä¢ Modelo listo para pruebas', 'success');
                log('', 'normal');
                
                document.getElementById('test-btn').style.display = 'block';
                document.getElementById('export-btn').style.display = 'block';
                document.getElementById('iterations').textContent = '10,000';
                document.getElementById('time').textContent = totalTime + 's';
                
            } catch (error) {
                clearInterval(progressInterval);
                log('', 'normal');
                log('‚ùå ERROR DURANTE EL ENTRENAMIENTO', 'error');
                log('   ' + error.message, 'error');
                console.error(error);
                document.getElementById('train-btn').disabled = false;
            }
        }

        function probarModelo() {
            if (!model) {
                log('‚ùå Error: Debes entrenar el modelo primero', 'error');
                return;
            }
            
            log('', 'normal');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'warning');
            log('     VALIDACI√ìN DEL MODELO ENTRENADO', 'warning');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'warning');
            log('', 'normal');
            
            const tests = [
                { input: [10, 20, 70], esperado: 'L√≠der Humano' },
                { input: [5, 30, 65], esperado: 'L√≠der Humano' },
                { input: [20, 70, 10], esperado: 'Colaborador Eficaz' },
                { input: [25, 60, 15], esperado: 'Colaborador Eficaz' },
                { input: [70, 20, 10], esperado: 'Dependiente Pasivo' },
                { input: [65, 25, 10], esperado: 'Dependiente Pasivo' },
                { input: [90, 8, 2], esperado: 'Aut√≥mata Controlado' },
                { input: [85, 10, 5], esperado: 'Aut√≥mata Controlado' }
            ];
            
            let aciertos = 0;
            
            tests.forEach((test, index) => {
                const prediccion = model.predict(test.input);
                const correcto = prediccion === test.esperado;
                if (correcto) aciertos++;
                
                const tipo = correcto ? 'success' : 'error';
                const simbolo = correcto ? '‚úì' : '‚úó';
                
                log(`${simbolo} Test ${index + 1}: [${test.input.join(', ')}]`, 'info');
                log(`    Predicci√≥n: ${prediccion}`, tipo);
                log(`    Esperado:   ${test.esperado}`, 'normal');
                log('', 'normal');
            });
            
            const accuracy = (aciertos / tests.length * 100).toFixed(1);
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            log(`üìä PRECISI√ìN FINAL: ${accuracy}% (${aciertos}/${tests.length} aciertos)`, 'success');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        function exportarPesos() {
            if (!window.TRAINED_WEIGHTS.weights_ih) {
                log('‚ùå Error: No hay pesos entrenados para exportar', 'error');
                return;
            }
            
            log('', 'normal');
            log('üíæ Exportando pesos entrenados...', 'warning');
            log('', 'normal');
            
            // Generar c√≥digo para copiar a trained_weights.js
            const weightsCode = `// PESOS ENTRENADOS - Generados el ${new Date().toLocaleString()}
// Copia estos valores dentro de TRAINED_WEIGHTS en trained_weights.js

weights_ih: ${JSON.stringify(window.TRAINED_WEIGHTS.weights_ih, null, 2)},

bias_h: ${JSON.stringify(window.TRAINED_WEIGHTS.bias_h, null, 2)},

weights_ho: ${JSON.stringify(window.TRAINED_WEIGHTS.weights_ho, null, 2)},

bias_o: ${JSON.stringify(window.TRAINED_WEIGHTS.bias_o, null, 2)}`;
            
            // Intentar copiar al portapapeles
            navigator.clipboard.writeText(weightsCode).then(() => {
                log('‚úÖ Pesos copiados al portapapeles exitosamente', 'success');
                log('', 'normal');
                log('üìù INSTRUCCIONES:', 'warning');
                log('   1. Abre el archivo trained_weights.js', 'info');
                log('   2. Busca las l√≠neas con "weights_ih: null"', 'info');
                log('   3. Pega el contenido del portapapeles', 'info');
                log('   4. Guarda el archivo', 'info');
                log('', 'normal');
                log('‚úÖ Listo para integraci√≥n en el juego', 'success');
            }).catch((err) => {
                log('‚ö†Ô∏è  No se pudo copiar autom√°ticamente', 'warning');
                log('   Revisa la consola del navegador (F12)', 'info');
                console.log('=== PESOS ENTRENADOS ===');
                console.log(weightsCode);
            });
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>